<!doctype html>
<meta charset=utf-8>
<title>CSS4セレクタ (Selectors Level 4) について</title>
<link rel=stylesheet href="lilium.css">
<link rel=license href="http://creativecommons.org/licenses/by-nc/3.0/">
<script>
if (!!document.addEventListener) {
  document.addEventListener('DOMContentLoaded', function () {
    var sec = document.querySelectorAll('body > section[id]');
    var h = document.querySelectorAll('body > section[id] > h2:first-of-type');    
    var toc = '';
    var l = sec.length;
    while (l--) {
      toc = '<li><a href="#' + sec[l].id + '">' + h[l].innerHTML + '</a>' + toc;
    }
    var nav = document.createElement('nav');
    nav.innerHTML = '<h2>目次</h2><ol>' + toc + '</ol>';
    document.body.insertBefore(nav, sec[0]);
  }, false);
}
</script>
<body>

<h1>CSS4セレクタ (Selectors Level 4) について</h1>
<!-- update: 2011-09-05 -->

<p><a href="http://www.w3.org/TR/css3-selectors/">CSS3のセレクタ仕様</a>が勧告されそうですが、CSS4のセレクタについても策定が始まっています。CSS4では誰もが考えた「親セレクタ」をはじめ、より高機能なセレクタが提案されています。このノートでは、CSS4セレクタの機能についてCSS3のセレクタと比べながら紹介します。

<section id=about-selectors4>
<h2>Selectors Level 4仕様について</h2>

<p><a>セレクタ Level 4 (Selectors Level 4)</a> は、<a href="http://www.w3.org/TR/css3-selectors/">Selectors Level 3</a>仕様の上位にある、新しいセレクタ仕様です。Level 3でも数多くのセレクタが追加されましたが、Level 4仕様ではさらに多くのセレクタが追加されています。

<p>2011年9月現在、Selectors Level 4はEditor's Draftという位置づけです。Editor's Draftとは仕様のEditorがまとめた仕様の案であり、公式な草案 (Working Draft) ではありません。W3CのCSSWGは、Selectors Level 3勧告と同時にSelectors Level 4の草案を公開する予定です (勧告される前に次のレベルが公開されたら、混乱する人がいるのではという懸念があるようです)。<!-- ref: http://lists.w3.org/Archives/Public/www-style/2011Aug/0645.html -->

<p>仕様が初期の段階ですから、仕様書にある機能がそのうちなくなる可能性があります。反対に、現在の仕様書にない新しいセレクタが追加される可能性もあります。

<p>そんな初期段階にある仕様ではありますが、思いのほか実装状況は良好です。これは、多くのセレクタがCSS3までのレベルに存在していたことがひとつあります。また、新しく追加されたセレクタについても、ブラウザの独自拡張を標準化したもの (<code>:any-link</code>, <code>:matches()</code>) や、他の仕様から移管されたもの (<code>:valid</code>, <code>:in-range</code>) ですので、次のレベルとはいえすでに実装が進んでいるとも言えます。

<aside id=is-selectors-css>
<h3>「CSS4セレクタ」か「セレクタ Level 4」か</h3>

<p>他のCSS3モジュールはたいてい「CSS <var>Foo</var> Module Level 3」と、CSS3のモジュールだと分かる名前になっていますが、セレクタ仕様については「Selectors Level 3」「Selectors Level 4」と、CSSの名を冠していません。どういうことでしょうか。セレクタ仕様はCSSではないのでしょうか。

<p>これは、他のCSSモジュールと違い、セレクタ仕様は他のWebプラットフォーム仕様で使われることがあるため、CSSに限定されないということを意味しています。たとえば、セレクタから要素を取得する<a href="http://www.w3.org/TR/selectors-api/">Selectors API</a>は、CSSの仕様ではありませんがセレクタを利用しています。セレクタと同様に、<a href="http://www.w3.org/TR/css3-mediaquries">Media Queries</a>もHTMLの<code>media</code>属性などで使われることから、CSSの名を冠していません。(一方で、URLには<b>css3-</b>とあり、CSS3でもあることがわかります。)

<p>とはいえ、セレクタ仕様やメディアクエリーが「CSSでない」というわけではありません。CSSだけに限定されてはいないだけで、どちらもCSSの機能ではあります。「CSS4セレクタ」という表記がおかしいわけではありません。

<!-- todo: 参考情報へのURLを探す。 -->
</aside>
</section>

<section id=terminology>
<h2>セレクタの構造と用語</h2>

<p>ふだん「セレクタ」と読んでいるものですが、仕様書に従うとじつはけっこう細かく分けられます。

<dl>
<dt>セレクタ
<dd>単体セレクタ、compound selector、complex selector、セレクタリストを総称
<dt>単体セレクタ
<dd>型セレクタ (要素型セレクタ、type selector)、ユニバーサルセレクタ、属性セレクタ、クラスセレクタ、IDセレクタ、擬似クラス
<dt>compound selector
<dd>結合子をはさまない単体セレクタの連なり
<dt>complex selector
<dd>compound selectorが結合子によって連なったもの
<dt>結合子
<dd>compound selector同士の関係を表すもの、空白、大なり、プラス記号、チルダがあり、俗にそれぞれ「子孫セレクタ」「子セレクタ」「隣接セレクタ」「◯◯セレクタ」などと呼ばれる
</dl>

<p class=XXX>compoundとcomplexってどう訳せばいいんだろう。。

</section>

<section id=subject>
<h2>セレクタの対象とCSS4の<code>$<var>selector</var></code></h2>

<p>CSS4セレクタでは、念願かなって要素の「親」を指定できるようになりました。<br>ただし、「親セレクタ」が導入されたわけではありません。むしろ、もっと便利な機能になっています。

<p>あるセレクタによって表される要素は、そのセレクタの「対象 (subject)」と呼ばれます。なにやら難しそうですが、要は書いたスタイルが適用される要素のことです。たとえば、<code>ul > li > a</code>というセレクタの対象は<code>a</code>要素です。

<p>CSS3までのセレクタでは、対象が常に、最後のcompound selectorが表す要素になっていました。なにやら難しそうですが、<code>ul > li > a</code>と書いたとき、それは最後の<code>a</code>を指し示していたわけです。当然、こんな構造のときの<code>li</code>は指定できませんでした。だからみんな「<code>a <strong>&lt;</strong> li</code>って書けるようにして」と言ってたわけです。

<p>CSS4では、この対象を変更できるようになりました。対象としたいcompound selectorの前にドル記号（<code>$</code>）をつけることで変更できます。<code>ul > <strong>$</strong>li > a</code>とすると、「子に<code>a</code>を持つ<code>li</code>要素」にスタイルを当てられるわけです。

<p class=XXX>todo: 例を書く。
<p class=XXX>todo: このわかりにくい説明をなんとかして、もうちょっとキャッチーな文にする。

</section>

<footer>
<address><a rel=author href="http://profiles.google.com/masataka.yakura">Masataka Yakura</a></address>
</footer>

