<!doctype html>
<meta charset=utf-8>
<title>スマートフォンと画面解像度・ピクセル密度</title>
<link rel=stylesheet href="lilium.css">
<link rel=license href="http://creativecommons.org/licenses/by-nc/3.0/">
<link rel=alternate href="https://github.com/myakura/n/commits/gh-pages.atom" type="application/atom+xml">
<script>
if (!!document.addEventListener) {
  document.addEventListener('DOMContentLoaded', function () {
    var sec = document.querySelectorAll('body > section[id]');
    var h = document.querySelectorAll('body > section[id] > h2:first-of-type');
    var toc = '';
    var l = sec.length;
    while (l--) {
      toc = '<li><a href="#' + sec[l].id + '">' + h[l].innerHTML + '</a>' + toc;
    }
    var nav = document.createElement('nav');
    nav.innerHTML = '<h2>目次</h2><ol>' + toc + '</ol>';
    document.body.insertBefore(nav, sec[0]);
  }, false);
}
</script>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26017405-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<body>

<h1>スマートフォンと画面解像度・ピクセル密度</h1>

<p>iPhone 4やAndroidスマートフォンで、Webサイトの画像がぼやけて見えることがあります。これには、端末の画面解像度、ピクセル密度、そしてCSSピクセルとデバイスピクセルの扱いといった、いくつかの要因が絡んでいます。

<section id=resolution-varies>
<h2>解像度のばらつくスマートフォン</h2>

<p>スマートフォン端末の画面サイズは端末により様々です。iPhoneは3.5インチですが、Androidスマートフォンは3インチ前半から4インチ後半まで、幅広く分布しています。
<p>画面サイズのばらつきも結構なものですが、解像度はそれよりも相当ばらついています。

<figure id=fig-table-size-resolution>
<table border>
<tr><th>端末
<td>iPhone 3
<td>Galaxy S
<td>Xperia arc
<td>Galaxy S Ⅱ
<td>INFOBAR A01
<td>iPhone 4
<td>Galaxy Nexus
<tr><th>画面サイズ (in)
<td>3.5
<td>4.0
<td>4.2
<td>4.3
<td>3.7
<td>3.5
<td>4.7
<tr><th>解像度 (px)
<td>320 × 480
<td>480 × 800
<td>480 × 854
<td>480 × 800
<td>560 × 960
<td>640 × 960
<td>720 × 1280
</table>
<figcaption>各スマートフォンの画面サイズと解像度</figcaption>
</figure>

<p>iPhone 4はiPhone 3と比べ、縦横それぞれ2倍、計4倍ものピクセル数があります。Galaxy Nexusを始め、2011年秋以降に発売されたハイエンドのAndroidスマートフォンは720 × 1280と、一昔まえのネットブックほどの解像度を備えています。

<p>これだけ解像度に開きがありながら、端末の大きさは (ばらつきもあるものの) 手でつかめるサイズに収まっています。こうなると、ピクセル密度に大きな違いがでてきます。

</section>

<section>
<h2>ピクセル密度と密度グループ</h2>

<p>ピクセル密度とは、主に1インチあたりのピクセル数をいうもので、DPI (dot per inch) やPPI (pixel per inch) などと呼ばれています。

<p>ピクセル密度が高いほど、面積あたりの解像度が高くなります。デスクトップではだいたいピクセル密度が同じ (100〜120くらい) なので、一般的に解像度が高くなるにつれ画面も大きくなります。反対に、スマートフォンは画面サイズが (だいたい) 同じなので、解像度が高くなるにつれ1ピクセルの大きさが小さくなり、画面が細密になります。<br>iPhone 4のRetina displayはiPhone 3の4倍の解像度 (縦横2倍) ですが、画面の大きさは同じ3.5インチです。ですので、iPhone 4のピクセル密度はiPhone 3の2倍になります。

<p>次の表は、いくつかの端末の解像度とピクセル密度を並べたものです。

<figure id=fig-table-density>
<table border>
<tr><th>端末
<td>iPhone 3
<td>Galaxy S
<td>Xperia arc
<td>Galaxy S Ⅱ
<td>INFOBAR A01
<td>iPhone 4
<td>Galaxy Nexus
<tr><th>画面サイズ (in)
<td>3.5
<td>4.0
<td>4.2
<td>4.3
<td>3.7
<td>3.5
<td>4.7
<tr><th>解像度 (px)
<td>320 × 480
<td>480 × 800
<td>480 × 854
<td>480 × 800
<td>560 × 960
<td>640 × 960
<td>720 × 1280
<tr><th>ピクセル密度 (dpi)
<td>163
<td>233
<td>233
<td>217
<td>298
<td>326
<td>312
</table>
<figcaption>各スマートフォンの解像度とピクセル密度</figcaption>
<span class=note>ピクセル密度は端末の製造/販売企業のWebサイトから、なければ端末のスペックから算出しています。</span>
</figure>

<p>表を見ていると、ピクセル密度が160前後, 210〜240, 300〜320と、すこしふれ幅はあるものの、おおよそ3つに分かれていることに気づきます。

<p>Androidでは、<a href="http://developer.android.com/guide/practices/screens_support.html#qualifiers">画面の性質でグループ分け</a>がされており、端末のピクセル密度についてもいくつかのグループに分かれています。

<figure id=fig-table-density-groups>
<table border>
<tr><th>グループ名
<td>ldpi
<td>mdpi
<td>hdpi
<td>xhdpi
<tr><th>dpi
<td>120
<td>160
<td>240
<td>320
</table>
<figcaption>Androidの密度グループ</figure>
</figure>

<p>iPhoneを当てはめると、iPhone 3までがmdpiで、iPhone 4からはxhdpiに相当します。日本で流通しているAndroidスマートフォンの多くはhdpiに属するでしょうが、最近のHD解像度の端末はxhdpiに属しそうです。

<p class=note>IS05やXperia ray, INFOBAR A01/C01など、グループ上はhdpiに属していますが、画面サイズが小さいためピクセル密度が300dpi近くと、xhdpiに近いピクセル密度となっています。こういった小型の端末が増えると、所属するグループだけでは画面の精細さやピクセルの大きさを判断するのは難しくなるでしょう。
</section>

<section>
<h2>ピクセル密度の違いが見た目に影響する</h2>

<p>さて、ピクセル密度のばらつきによって、すこし困ったことが起こります。密度の低い環境に合わせて作られたコンテンツの見た目が、密度の高い環境で良く見えない可能性が出てくるのです。

<p>iPhone 4やAndroidスマートフォンでWebサイトを表示すると、画像がぼやけて見えることがあります。iPhone 4の場合は、古いアプリケーションのアイコンがぼやけることもあるでしょう。

<figure>
<img src=density/asahicom_retina.png style="border-radius: 6px">
<figcaption>mini.asahi.comをRetina displayで表示した例 (シミュレータ利用)。ロゴや「トップ」「写真」といった画像の文字が、その下にある「ニュース」などのテキストと比べて荒く表示されているのがわかる。</figcaption>
</figure>

<p>iPhone 4のRetina displayでは文字の綺麗さなどをうたっていますが、画像が綺麗に見えないのはどうしてでしょうか。ここで出てくるのが、デバイスピクセルとCSSピクセルという、2種類の「ピクセル」です。
</section>

<section id=dpx-vs-csspx>
<h2>「デバイスピクセル」と「CSSピクセル」</h2>

<p>Webデザインにおける「ピクセル」は、ほとんどの場合「CSSピクセル」を指します。一方、画面のピクセルは「デバイスピクセル」と呼ばれたりします。

<p class=note>以下に出てくる「csspx」はCSSピクセルを、「dpx」はデバイスピクセルを表します。

<p>iPhone 4の画面は640dpx × 960dpxです。iPhone 3が320dpx × 480dpxなので、iPhone 4はiPhone 3に比べて縦横2倍、計4倍のデバイスピクセルを持ちます。解像度が高く今までより広い範囲を表示できますが、実際にそう表示してしまうと、画面に表示される多くのものがこれまでの半分の大きさで表示されてしまいます。iPhoneの物理的な大きさを考えると、半分の大きさで表示されたWebサイトは読めたものではないでしょう。また、アプリケーションなども操作できたものではないでしょう。

<p>これを解決するために、iPhone 4のSafariではひとつのCSSピクセルをふたつのデバイスピクセルで表しています。1csspx = 2dpxですから、<code>border-width: 2px</code>は4dpxの線で描画されることになりますし、「100px × 100px」な画像は200dpx × 200dpxの領域に描画されます。<br>一方、ベクターで計算されるもの (アウトラインフォント、SVGのパスなど) は描画される箇所のデバイスピクセルが細かいので、精細に表示されます。画像がぼやける一方でフォントが綺麗なのはこのためです。

<p>Androidスマートフォンは、端末の密度グループによってデバイスピクセルとCSSピクセルのマッピングが異なります。ひとつのデバイスピクセルをひとつのCSSピクセルで表示するのは、iPhoneにあわせてmdpi (160dpi) の端末です。このmdpiにおける1ピクセルは“density-independent pixel (dp, dip)” と呼ばれています。さて、hdpi (240dpi) は160dpiの1.5倍ですから、1csspx = 1.5dpxとなります。

<p>現在使われているAndroidスマートフォンの多くはhdpiに属すので、<code>border-width: 2px</code>は3dpxで表されることになります。そして、1csspxは1.5dpxと整数値で割り切れないため値が丸められ、1csspxで指定された線が消える・細く見えることがあります。

<p>デバイスピクセルとCSSピクセルの対応比は、「デバイスピクセル比」(“device pixel ratio”) などと呼ばれています。Chrome, Safari, Operaでは、<code>window.devicePixelRatio</code>というプロパティからこの値を取得できます。

<figure id=fig-table-dpxratio>
<table border style="text-align: center">
<tr><th>端末
<td>iPhone 3
<td>Galaxy S
<td>Xperia arc
<td>Galaxy S Ⅱ
<td>INFOBAR A01
<td>iPhone 4
<td>Galaxy Nexus
<tr><th>解像度 (px)
<td>320 × 480
<td>480 × 800
<td>480 × 854
<td>480 × 800
<td>560 × 960
<td>640 × 960
<td>720 × 1280
<tr><th>密度のカテゴリ
<td>160
<td>240
<td>240
<td>240
<td>240
<td>320
<td>320
<tr><th>dpx比
<td>1
<td>1.5
<td>1.5
<td>1.5
<td>1.5
<td>2
<td>2
</table>
<figcaption>各スマートフォン端末の画面解像度、ピクセル密度、デバイスピクセル比</figcaption>
</figure>

<aside>
<h3>デバイスピクセル比はスマートフォンだけの問題でもない</h3>
<p>デバイスピクセルとCSSピクセルが1:1でマッチしないのはモバイル固有ではなく、デスクトップでも起こりうる話です。たとえば、WindowsではディスプレイのDPI設定から「125％ (120dpi)」を選択すると、Internet Explorer上で1csspxが1.25dpxとして扱われます。DPI設定は通常96dpiになっているはずなのですが、まれに120dpiが出荷時に設定されているPCが存在します……
<p>Macでも高解像度モードにすることでデバイスピクセル比を変更できます。ちなみに先ほど紹介した<code>window.devicePixelRatio</code>はこの高解像度モードのために実装されています。実装されたのは2006年と今から5年前、iPhone4の登場よりだいぶ前です。
</aside>
</section>
<!--
<section id=>
<h2>解像度・ピクセル密度の違いに対処する</h2>

<p class=XXX>別におこしたほうがいい気もする。タブレットも含める？

<ul class=XXX>
<li>&lt;img width>
<li>viewport
<li>device-pixel-ratio (bg-size)
<li>target-densitydpi
<li>svg
<li>css
</ul>



</section>

<section>
<h3>width/height属性とbackground-sizeプロパティの利用</h3>
<p><code>img</code>要素には<code>width</code>, <code>height</code>という、画像の表示幅（高さ）をピクセルで指定する属性があります。CSSにも同名のプロパティや、<code>background-size</code>など大きさを指定するプロパティがあります。

<p>大きな解像度の画像を用意して、これらの属性もしくはプロパティでその表示幅（高さ）を指定すると、ブラウザはその寸法にあわせ画像を拡大縮小し表示します。

<figure>
<pre><code>&lt;img src=image_wxh.png width= height=></code></pre>
<figcaption>大きな画像をwidth/height属性から指定して</figcaption>
</figure>

<p>ANAのiPhone, iPad用Webサイトでは、この方法が使われています。ヘッダやアイコンに表示サイズ（ピクセル）よりも大きな画像を用意し、

<p>ただし、大きな画像を用意しますから、ファイルサイズが増えてしまいます。ネットワークの品質がよくないとダウンロードに時間がかかるでしょう。また、画像を縮小して描画するので、もしかするとパフォーマンスに影響するかもしれません。

<p>ただ、<code>background-size</code>などは除きますが、古くからある属性・プロパティですから、変なバグに遭遇する可能性は低そうです。

</section>

<section>
<h3>viewport</h3>

<p>あらかじめ大きな解像度でつくったページを

<p>640の幅でつくったものを縮小する

<p>デスクトップでは有効にされていないので、幅が640px想定になります。見た感じがだいぶ違うでしょう。Photoshopなどのカンプ作成時も、コントロールが不自然に小さくなるなど、。。

</section>
-->

<footer>
<address>by <a rel=author href="http://profiles.google.com/masataka.yakura">Masataka Yakura</a></address>
<p class=update>Update: April 27, 2012
</footer>
